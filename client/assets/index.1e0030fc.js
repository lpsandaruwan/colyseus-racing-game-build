var Bt=Object.defineProperty,Lt=Object.defineProperties;var Tt=Object.getOwnPropertyDescriptors;var de=Object.getOwnPropertySymbols;var He=Object.prototype.hasOwnProperty,Ue=Object.prototype.propertyIsEnumerable;var We=(e,t,n)=>t in e?Bt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,d=(e,t)=>{for(var n in t||(t={}))He.call(t,n)&&We(e,n,t[n]);if(de)for(var n of de(t))Ue.call(t,n)&&We(e,n,t[n]);return e},w=(e,t)=>Lt(e,Tt(t));var j=(e,t)=>{var n={};for(var o in e)He.call(e,o)&&t.indexOf(o)<0&&(n[o]=e[o]);if(e!=null&&de)for(var o of de(e))t.indexOf(o)<0&&Ue.call(e,o)&&(n[o]=e[o]);return n};import{c as At,s as _t,r as c,d as nt,u as O,j as r,P as K,M as H,a as h,F as D,b as st,O as _e,V,e as ze,f as Fe,Q as zt,E as Ft,g as ge,h as Dt,i as Vt,k as Z,l as Ot,D as $t,m as ye,n as Wt,C as Ht,o as Ut,p as Gt,q as ie,t as at,v as te,w as jt,x as we,y as Yt,z as me,A as Jt,B as qt,S as Kt,G as Xt,H as Qt,I as Zt,J as er,K as tr,L as rr,N as or,R as nr,T as sr,U as ar,W as ir,X as lr,Y as cr,Z as ur,_ as dr,$ as mr}from"./vendor.f2cf0661.js";const hr=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))o(s);new MutationObserver(s=>{for(const a of s)if(a.type==="childList")for(const i of a.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&o(i)}).observe(document,{childList:!0,subtree:!0});function n(s){const a={};return s.integrity&&(a.integrity=s.integrity),s.referrerpolicy&&(a.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?a.credentials="include":s.crossorigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function o(s){if(s.ep)return;s.ep=!0;const a=n(s);fetch(s.href,a)}};hr();const le=e=>Object.keys(e),pr=[0,.5,0],he=["DEFAULT","FIRST_PERSON","BIRD_EYE"],it=1.5,fe=1,De=100,gr=[0,Math.PI/2+.35,0],Ve={width:1.7,height:-.3,front:1.35,back:-1.3,steer:.3,force:1800,maxBrake:65,maxSpeed:88},Oe={axleLocal:[-1,0,0],customSlidingRotationalSpeed:-.01,directionLocal:[0,-1,0],frictionSlip:1.5,radius:.38,rollInfluence:0,sideAcceleration:3,suspensionRestLength:.35,suspensionStiffness:30,useCustomSlidingRotationalSpeed:!0},Re={binding:!1,debug:!1,editor:!1,help:!1,leaderboard:!1,map:!0,pickcolor:!1,ready:!1,shadows:!0,stats:!1,sound:!0},lt=["help","leaderboard","pickcolor"],fr=e=>lt.includes(e),Ne={backward:!1,boost:!1,brake:!1,forward:!1,honk:!1,left:!1,right:!1},yr=e=>Object.hasOwnProperty.call(Ne,e),wr={backward:["arrowdown","s"],boost:["shift"],brake:[" "],camera:["c"],editor:["."],forward:["arrowup","w","z"],help:["i"],honk:["h"],leaderboard:["l"],left:["arrowleft","a","q"],map:["m"],pickcolor:["p"],reset:["r"],right:["arrowright","d","e"],sound:["u"]},xr=(e,t)=>()=>e(n=>d({},lt.reduce((o,s)=>w(d({},o),{[s]:s===t?!n[t]:!1}),n))),$e=At((e,t)=>{const n=le(Ne).reduce((a,i)=>(a[i]=l=>e(u=>({controls:w(d({},u.controls),{[i]:l})})),a),{}),o=le(Re).reduce((a,i)=>(a[i]=fr(i)?xr(e,i):()=>e(l=>w(d({},l),{[i]:!l[i]})),a),{}),s=w(d(d({},o),n),{camera:()=>e(a=>({camera:he[(he.indexOf(a.camera)+1)%he.length]})),onCheckpoint:()=>{const{start:a}=t();if(a){const i=Date.now()-a;e({checkpoint:i})}},onFinish:()=>{const{finished:a,start:i}=t();i&&!a&&e({finished:Math.max(Date.now()-i,0)})},onStart:()=>{e({finished:0,start:Date.now()})},reset:()=>{x.boost=De,e(a=>{var i,l,u;return(i=a.api)==null||i.angularVelocity.set(...pr),(l=a.api)==null||l.rotation.set(...gr),(u=a.api)==null||u.velocity.set(0,0,0),w(d({},a),{finished:0,start:0})})}});return w(d({},Re),{actionInputMap:wr,actions:s,api:null,bestCheckpoint:0,camera:he[0],chassisBody:c.exports.createRef(),checkpoint:0,color:"#FFFF00",controls:Ne,keyBindingsWithError:[],dpr:it,finished:0,get:t,keyInput:null,level:c.exports.createRef(),session:null,set:e,start:0,vehicleConfig:Ve,wheelInfo:Oe,wheels:[c.exports.createRef(),c.exports.createRef(),c.exports.createRef(),c.exports.createRef()]})}),x={boost:De,rpmTarget:0,sliding:!1,speed:0,velocity:[0,0,0]},v=e=>$e(e,_t);Object.assign(v,$e);const{getState:G,setState:Q}=$e;function vr(){const[e,t,n]=v(({actions:o,actionInputMap:s,binding:a})=>[o,s,a]);return c.exports.useEffect(()=>{if(n)return;const o=le(t).reduce((i,l)=>d(d({},i),t[l].reduce((u,p)=>w(d({},u),{[p]:l}),{})),{}),s=({key:i,target:l})=>{const u=o[i.toLowerCase()];!u||l.nodeName==="INPUT"||!yr(u)||e[u](!0)},a=({key:i,target:l})=>{const u=o[i.toLowerCase()];!u||l.nodeName==="INPUT"||e[u](!1)};return window.addEventListener("keydown",s,{passive:!0}),window.addEventListener("keyup",a,{passive:!0}),()=>{window.removeEventListener("keydown",s),window.removeEventListener("keyup",a)}},[t,n]),null}function br({delay:e=3e3}){return c.exports.useEffect(()=>{let t=!0;const n=nt(()=>{t=!0,document.documentElement.style.cursor="none"},e),o=()=>{t&&(t=!1,document.documentElement.style.cursor=""),n()};return window.addEventListener("mousemove",o,{passive:!0}),()=>window.removeEventListener("mousemove",o)},[e]),null}const{lerp:kr}=H,ct=()=>{const e=c.exports.useRef(null),t=v(({vehicleConfig:{maxSpeed:o}})=>o),n=()=>2*x.speed/t;return O((o,s)=>{var a,i;(a=e.current)==null||a.setVolume(n()),(i=e.current)==null||i.setPlaybackRate(kr(e.current.playbackRate,x.rpmTarget+.5,s*10))}),c.exports.useEffect(()=>(e.current&&!e.current.isPlaying&&(e.current.setVolume(n()),e.current.play()),()=>{e.current&&e.current.isPlaying&&e.current.stop()}),[]),r(K,{ref:e,url:"/sounds/accelerate.mp3",loop:!0,distance:5})},ut=()=>{const e=c.exports.useRef(null),[t,n,o]=v(({controls:{boost:s},vehicleConfig:{maxSpeed:a},sound:i})=>[s,a,i]);return O(()=>{var a,i,l;const s=Math.pow(x.speed/n,1.5)+.5;(a=e.current)==null||a.setVolume(s*1.5),(i=e.current)==null||i.setPlaybackRate(s),!x.boost&&((l=e.current)==null?void 0:l.isPlaying)&&e.current.stop()}),c.exports.useEffect(()=>{if(e.current&&o){const s=t&&x.boost>0;s&&!e.current.isPlaying&&e.current.play(),!s&&e.current.isPlaying&&e.current.stop()}return()=>{e.current&&e.current.isPlaying&&e.current.stop()}},[t,o]),r(K,{ref:e,url:"/sounds/boost.mp3",distance:5})},dt=()=>{const e=c.exports.useRef(null),[t,n]=v(({controls:{brake:o},sound:s})=>[o,s]);return O(()=>{var o;x.speed<=10&&((o=e.current)==null?void 0:o.isPlaying)&&e.current.stop()}),c.exports.useEffect(()=>{if(e.current&&n){const o=t&&x.speed>10;o&&!e.current.isPlaying&&e.current.play(),!o&&e.current.isPlaying&&e.current.stop()}return()=>{e.current&&e.current.isPlaying&&e.current.stop()}},[t,n]),r(K,{ref:e,url:"/sounds/tire-brake.mp3",distance:10})},{lerp:Cr}=H,mt=()=>{const e=c.exports.useRef(null),t=v(({vehicleConfig:{maxSpeed:o}})=>o),n=()=>1-x.speed/t;return O((o,s)=>{var a,i;(a=e.current)==null||a.setVolume(n()),(i=e.current)==null||i.setPlaybackRate(Cr(e.current.playbackRate,x.rpmTarget+1,s*10))}),c.exports.useEffect(()=>(e.current&&!e.current.isPlaying&&(e.current.setVolume(n()),e.current.play()),()=>{e.current&&e.current.isPlaying&&e.current.stop()}),[]),r(K,{autoplay:!0,ref:e,url:"/sounds/engine.mp3",loop:!0,distance:5})},ht=()=>{const e=c.exports.useRef(null),[t,n]=v(({controls:{honk:o},sound:s})=>[o,s]);return c.exports.useEffect(()=>(e.current&&n&&(t&&!e.current.isPlaying&&e.current.play(),!t&&e.current.isPlaying&&e.current.stop()),()=>{e.current&&e.current.isPlaying&&e.current.stop()}),[t,n]),r(K,{ref:e,url:"/sounds/honk.mp3",distance:10})};function Sr(){const[e,t]=v(n=>[n.camera,n.editor]);return h(D,{children:[r(st,{makeDefault:!t&&e!=="BIRD_EYE",fov:75,rotation:[0,Math.PI,0],position:[0,10,-20]}),r(_e,{makeDefault:!t&&e==="BIRD_EYE",position:[0,100,0],rotation:[-1*Math.PI/2,0,Math.PI],zoom:15})]})}const pe=new V,je=new ze,q=new Fe,Mr=new zt;function pt({count:e=200,opacity:t=.1,size:n=1}){const o=v(f=>f.wheels),s=c.exports.useRef(null);let a,i=0,l=0,u=0,p=0;return O((f,k)=>{if(!!s.current)if(a=G().controls.brake,u=H.lerp(u,Number(x.sliding||a)*x.speed/40,k*8),f.clock.getElapsedTime()-p>.02&&o[2].current&&o[3].current)p=f.clock.getElapsedTime(),Ye(s.current,o[2].current.getWorldPosition(pe),l++,u),Ye(s.current,o[3].current.getWorldPosition(pe),l++,u),l===e&&(l=0);else for(i=0;i<e;i++)s.current.getMatrixAt(i,je),je.decompose(q.position,Mr,pe),q.scale.setScalar(Math.max(0,pe.x-.005)),q.updateMatrix(),s.current.setMatrixAt(i,q.matrix),s.current.instanceMatrix.needsUpdate=!0}),h("instancedMesh",{ref:s,args:[void 0,void 0,e],children:[r("sphereGeometry",{args:[n,10,10]}),r("meshBasicMaterial",{color:"white",transparent:!0,opacity:t,depthWrite:!1})]})}let xe;function Ye(e,t,n,o){xe=H.randFloatSpread(.25),q.position.set(t.x+xe,t.y-.4,t.z+xe),q.scale.setScalar(Math.random()*o),q.updateMatrix(),e.setMatrixAt(n,q.matrix),e.instanceMatrix.needsUpdate=!0}const re=new Fe,se=[new V(-.4,-.5,-1.8),new V(.4,-.5,-1.8)];function gt({count:e=12,opacity:t=.5,size:n=.1}){const o=c.exports.useRef(null);let s,a=!1,i,l,u;return O(p=>{for(a=x.boost>0&&G().controls.boost,s=0;s<e;s+=se.length)for(l=H.randFloatSpread(.05),i=0;i<se.length;i++)u=(p.clock.getElapsedTime()+(s+i)*.2)%1,re.position.set(se[i].x+l,se[i].y,se[i].z-u*.75),re.rotation.z+=u/2,re.scale.setScalar(a?(1-u)*2:0),re.matrixWorldNeedsUpdate=!0,re.updateMatrixWorld(),o.current&&(o.current.setMatrixAt(s+i,re.matrixWorld),o.current.instanceMatrix.needsUpdate=!0)}),h("instancedMesh",{ref:o,args:[void 0,void 0,e],children:[r("boxGeometry",{args:[n,n,n]}),r("meshBasicMaterial",{color:"#5ecfff",transparent:!0,opacity:t,depthWrite:!0})]})}const ve=new Ft,Er=new ze,ae=new Fe,Pr=new V;function ft({count:e=500,opacity:t=.5,size:n=.4}){const o=c.exports.useRef(null),[s,a]=v(u=>[u.chassisBody,u.wheels]);let i,l=0;return O(()=>{i=G().controls.brake,s.current&&a[2].current&&a[3].current&&i&&x.speed>10&&(ve.setFromRotationMatrix(Er.extractRotation(s.current.matrix)),Je(o.current,ve,a[2].current,l++),Je(o.current,ve,a[3].current,l++),l===e&&(l=0))}),c.exports.useLayoutEffect(()=>(o.current.geometry.rotateX(-Math.PI/2),()=>{o.current.geometry.rotateX(Math.PI/2)})),h("instancedMesh",{ref:o,args:[void 0,void 0,e],children:[r("planeGeometry",{args:[n,n*2]}),r("meshBasicMaterial",{color:"black",transparent:!0,opacity:t,depthWrite:!1})]})}function Je(e,t,n,o){ae.position.copy(n.getWorldPosition(Pr)),ae.rotation.copy(t),ae.scale.setScalar(1),ae.updateMatrix(),e.setMatrixAt(o,ae.matrix),e.instanceMatrix.needsUpdate=!0}const Be=document.createElement("canvas"),oe=Be.getContext("2d");oe&&(oe.imageSmoothingEnabled=!1);function Ir(e){if(!oe)throw new Error("Heightfield could not be created");const t=e.width,n=e.height,o=Array(t),s=Array(n),a=40;let i;Be.width=t,Be.height=n,oe.drawImage(e,0,0,t,n);const{data:l}=oe.getImageData(0,0,t,n);for(let u=0;u<t;u++){for(let p=0;p<n;p++)i=l[4*(p*t+u)]*a/255,s[p]=Number(Math.max(0,i).toPrecision(2))/4;o[u]=[...s]}return oe.clearRect(0,0,t,n),o}function Rr({elementSize:e,position:t,rotation:n}){const o=ge("/textures/heightmap_1024.png"),s=Dt(async()=>Ir(o.image),o);return Vt(()=>({args:[s,{elementSize:e}],position:t,rotation:n}),void 0,[e,t,n]),null}const F=(e,t)=>n=>{const o=Array.isArray(t)?t:[t];return v(a=>o.map(i=>a[i])).every(a=>!!a)?r(e,d({},n)):n.children?r(D,{children:n.children}):null};function Nr(){const e=v(l=>l.level),{nodes:t,materials:n}=Z("/models/track-draco.glb"),o={receiveShadow:!0,castShadow:!0,"material-roughness":1},s=c.exports.useRef(null),a=c.exports.useRef(null);c.exports.useLayoutEffect(()=>{var l;return void((l=e.current)==null?void 0:l.traverse(u=>u.layers.enable(fe)))},[]),O((l,u)=>{s.current.children.forEach((p,f)=>p.rotation.y+=u/f),a.current.children.forEach((p,f)=>p.rotation.y+=u/25/f)});const i=F(K,["ready","sound"]);return h("group",{dispose:null,children:[r("mesh",d({geometry:t.track_2.geometry,material:n["Material.001"]},o)),r("mesh",d({geometry:t.tube.geometry,material:n.default},o)),h("group",{ref:e,children:[r("mesh",d({geometry:t.strip.geometry,material:t.strip.material},o)),r("mesh",d({geometry:t.track_1.geometry,material:t.track_1.material},o)),r("mesh",d({geometry:t.mountains.geometry,material:t.mountains.material},o)),r("mesh",d({geometry:t.terrain.geometry,material:t.terrain.material},o)),h("mesh",{geometry:t.water.geometry,children:[r(Ot,{speed:4,map:n.ColorPaletteWater.map,roughness:0,side:$t}),r(i,{url:"/sounds/water.mp3",loop:!0,autoplay:!0,distance:10})]})]}),h("group",{ref:s,children:[r("mesh",d({geometry:t.bird001.geometry,material:t.bird001.material},o)),r("mesh",d({geometry:t.bird002.geometry,material:t.bird002.material},o)),r("mesh",d({geometry:t.bird003.geometry,material:t.bird003.material},o)),r("mesh",d({geometry:t.bird.geometry,material:t.bird.material},o))]}),r("mesh",d({geometry:t.blade001.geometry,material:t.blade001.material},o)),r("mesh",d({geometry:t.blade002.geometry,material:t.blade002.material},o)),r("mesh",d({geometry:t.blade003.geometry,material:t.blade003.material},o)),r("mesh",d({geometry:t.blade004.geometry,material:t.blade004.material},o)),r("mesh",d({geometry:t.blade005.geometry,material:t.blade005.material},o)),r("mesh",d({geometry:t.blade006.geometry,material:t.blade006.material},o)),r("mesh",d({geometry:t.blade.geometry,material:t.blade.material},o)),h("group",{ref:a,children:[r("mesh",{geometry:t.cloud001.geometry,material:t.cloud001.material,position:[-8.55,27.94,-7.84],rotation:[0,.26,0]}),r("mesh",{geometry:t.cloud003.geometry,material:t.cloud003.material,position:[-8.55,7.47,-7.84]}),r("mesh",{geometry:t.cloud006.geometry,material:t.cloud006.material,position:[-43,11.66,8.15]}),r("mesh",{geometry:t.cloud008.geometry,material:t.cloud008.material,position:[16.29,8.22,-7.84]}),r("mesh",{geometry:t.cloud010.geometry,material:t.cloud010.material,position:[6.63,7.79,-7.84]}),r("mesh",{geometry:t.cloud011.geometry,material:t.cloud011.material,position:[-8.55,-8.74,-7.84]}),r("mesh",{geometry:t.cloud002.geometry,material:t.cloud002.material,position:[49.41,27.94,-17.5],rotation:[-Math.PI,.92,-Math.PI]}),r("mesh",{geometry:t.cloud004.geometry,material:t.cloud004.material,position:[10.77,11.73,17],rotation:[-Math.PI,1.19,-Math.PI]}),r("mesh",{geometry:t.cloud012.geometry,material:t.cloud012.material,position:[11.47,-16.12,-66.08],rotation:[-Math.PI,.92,-Math.PI]}),r("mesh",{geometry:t.cloud007.geometry,material:t.cloud007.material,position:[-8.55,22.81,-7.84],rotation:[Math.PI,-1.43,Math.PI]}),r("mesh",{geometry:t.cloud009.geometry,material:t.cloud009.material,position:[-32.93,17.92,-7.84],rotation:[Math.PI,-.79,Math.PI]}),r("mesh",{geometry:t.cloud.geometry,material:t.cloud.material,position:[-66.73,-4.76,-17.35],rotation:[Math.PI,-.79,Math.PI]}),r("mesh",{geometry:t.cloud005.geometry,material:t.cloud005.material,position:[25.95,27.94,-23.02],rotation:[-Math.PI,.31,-Math.PI]})]})]})}function Br({args:e=[38,8,10],position:t=[-145.84,3.42,54.67],rotation:n=[0,-.09,0]}){const o=c.exports.useRef(null),{animations:s,nodes:a,materials:i}=Z("/models/track-draco.glb"),[,l]=ye(()=>({mass:1e4,type:"Kinematic",args:e,position:t,rotation:n}),o,[e,t,n]),{actions:u}=Wt(s,o),p={receiveShadow:!0,castShadow:!0,"material-roughness":1};c.exports.useLayoutEffect(()=>{var k;return void((k=u.train)==null?void 0:k.play())},[u]),O(()=>{l.position.set(o.current.position.x,o.current.position.y,o.current.position.z),l.rotation.set(o.current.rotation.x,o.current.rotation.y-.09,o.current.rotation.z)});const f=F(K,["ready","sound"]);return h("group",{ref:o,name:"train",position:t,rotation:n,dispose:null,children:[r("mesh",d({geometry:a.train_1.geometry,material:i.custom7Clone},p)),r("mesh",d({geometry:a.train_2.geometry,material:i.blueSteelClone},p)),r("mesh",d({geometry:a.train_3.geometry,material:i.custom12Clone},p)),r("mesh",d({geometry:a.train_4.geometry,material:i.custom14Clone},p)),r("mesh",d({geometry:a.train_5.geometry,material:i.defaultMatClone},p)),r("mesh",d({geometry:a.train_6.geometry,material:i.glassClone},p)),r("mesh",d({geometry:a.train_7.geometry,material:i.steelClone},p)),r("mesh",d({geometry:a.train_8.geometry,material:i.lightRedClone},p)),r("mesh",d({geometry:a.train_9.geometry,material:i.darkClone},p)),r(f,{url:"/sounds/train.mp3",loop:!0,autoplay:!0,distance:5})]})}const Lr=10;new Ht;const Tr=new V,yt=c.exports.forwardRef((a,s)=>{var i=a,{args:e=[2,1.1,4.7],mass:t=500,children:n}=i,o=j(i,["args","mass","children"]);const l=c.exports.useRef(null),u=c.exports.useRef(null),p=c.exports.useRef(null),f=c.exports.useRef(null),k=c.exports.useRef(null),E=c.exports.useRef(null),[I]=v(P=>[P.vehicleConfig.maxSpeed]),{nodes:g,materials:b}=Z("/models/chassis-draco.glb"),C=c.exports.useCallback(nt(P=>{P.body.userData.trigger||!G().sound||!E.current||(E.current.setVolume(Ut(P.contact.impactVelocity/10,.2,1)),E.current.isPlaying||E.current.play())},200),[]),[,y]=ye(()=>d({mass:t,args:e,allowSleep:!1,onCollide:C},o),s);return c.exports.useEffect(()=>(Q({api:y}),()=>Q({api:null})),[y]),c.exports.useLayoutEffect(()=>y.velocity.subscribe(P=>{const B=Tr.set(...P).length(),z=B/(I/Lr),$=Math.max((z%1+Math.log(z))/6,0);Object.assign(x,{rpmTarget:$,speed:B,velocity:P})}),[I]),O((P,B)=>{}),h("group",{ref:s,dispose:null,children:[h("group",{position:[0,-.2,-.2],children:[r("mesh",{ref:k,castShadow:!0,receiveShadow:!0,geometry:g.Chassis_1.geometry,material:b.BodyPaint,"material-color":"#f0c050"}),r("mesh",{castShadow:!0,geometry:g.Chassis_2.geometry,material:g.Chassis_2.material,"material-color":"#353535"}),r("mesh",{castShadow:!0,ref:l,geometry:g.Glass.geometry,material:b.Glass,"material-transparent":!0}),r("mesh",{ref:u,geometry:g.BrakeLights.geometry,material:b.BrakeLight,"material-transparent":!0}),r("mesh",{geometry:g.HeadLights.geometry,material:b.HeadLight}),r("mesh",{geometry:g.Cabin_Grilles.geometry,material:b.Black}),r("mesh",{geometry:g.Undercarriage.geometry,material:b.Undercarriage}),r("mesh",{geometry:g.TurnSignals.geometry,material:b.TurnSignal}),r("mesh",{geometry:g.Chrome.geometry,material:g.Chrome.material}),h("group",{ref:p,position:[.37,.25,.46],children:[r("mesh",{geometry:g.Wheel_1.geometry,material:g.Wheel_1.material}),r("mesh",{geometry:g.Wheel_2.geometry,material:g.Wheel_2.material})]}),h("group",{position:[0,0,0],children:[r("mesh",{geometry:g.License_1.geometry,material:b.License}),r("mesh",{geometry:g.License_2.geometry,material:g.License_2.material})]}),h("group",{position:[.2245,.3045,.6806],scale:[.0594,.0594,.0594],children:[r("mesh",{geometry:g.Cube013.geometry,material:g.Cube013.material}),r("mesh",{geometry:g.Cube013_1.geometry,material:g.Cube013_1.material}),r("mesh",{geometry:g.Cube013_2.geometry,material:g.Cube013_2.material})]}),r("mesh",{geometry:g["pointer-left"].geometry,material:g["pointer-left"].material,position:[.5107,.3045,.6536],rotation:[Math.PI/2,-1.1954,0],scale:[.0209,.0209,.0209]}),r("mesh",{ref:f,geometry:g["pointer-right"].geometry,material:g["pointer-right"].material,position:[.2245,.3045,.6536],rotation:[-Math.PI/2,-.9187,Math.PI],scale:[.0209,.0209,.0209]})]}),n,r(K,{ref:E,url:"/sounds/crash.mp3",loop:!1,distance:5})]})}),wt=c.exports.forwardRef((o,n)=>{var s=o,{leftSide:e}=s,t=j(s,["leftSide"]);const{radius:a}=v(p=>p.wheelInfo),{nodes:i,materials:l}=Z("/models/wheel-draco.glb"),u=a/.34;return Gt(()=>d({mass:50,type:"Kinematic",material:"wheel",collisionFilterGroup:0,shapes:[{args:[a,a,.5,16],rotation:[0,0,-Math.PI/2],type:"Cylinder"}]},t),n,[a]),r("group",{ref:n,dispose:null,children:r("group",{scale:u,children:h("group",{scale:e?-1:1,children:[r("mesh",{castShadow:!0,geometry:i.Mesh_14.geometry,material:l["Material.002"]}),r("mesh",{castShadow:!0,geometry:i.Mesh_14_1.geometry,material:l["Material.009"]})]})})})}),{lerp:be}=H,ke=new V;function Ar({angularVelocity:e,children:t,position:n,rotation:o}){const s=ie(R=>R.camera),[a,i,l,u]=v(R=>[R.chassisBody,R.vehicleConfig,R.wheelInfo,R.wheels]),{back:p,force:f,front:k,height:E,maxBrake:I,steer:g,maxSpeed:b,width:C}=i,y=u.map((R,A)=>{const N=A<2?k:p,_=A%2?.5:-.5;return w(d({},l),{chassisConnectionPointLocal:[C*_,E,N],isFrontWheel:Boolean(A%2)})}),P={chassisBody:a,wheels:u,wheelInfos:y},[,B]=at(()=>P,null,[l]);c.exports.useLayoutEffect(()=>B.sliding.subscribe(R=>x.sliding=R),[B]);let z,$,m,X=0,S=0,W=!1,M=0,T=0,L=0,U=0,J=0;O((R,A)=>{for(z=G().camera,$=G().editor,m=G().controls,M=x.speed,W=m.boost&&x.boost>0,W&&(x.boost=Math.max(x.boost-1,0)),X=be(X,m.forward||m.backward?f*(m.forward&&!m.backward?W?-1.5:-1:1):0,A*20),T=be(T,m.left||m.right?g*(m.left&&!m.right?1:-1):0,A*20),S=2;S<4;S++)B.applyEngineForce(M<b?X:0,S);for(S=0;S<2;S++)B.setSteeringValue(T,S);for(S=2;S<4;S++)B.setBrake(m.brake?m.forward?I/1.5:I:0,S);$||(z==="FIRST_PERSON"?ke.set(.3+Math.sin(-T)*M/30,.4,-.1):z==="DEFAULT"&&ke.set(Math.sin(T)*M/2.5,1.25+X/1e3*-.5,-5-M/15+(m.brake?1:0)),s.position.lerp(ke,A),s.rotation.z=be(s.rotation.z,(z!=="BIRD_EYE"?0:Math.PI)+-T*M/(z==="DEFAULT"?40:60),A)),a.current.children[0].rotation.z=H.lerp(a.current.children[0].rotation.z,-T*M/200,A*4),L=W?60:30,U=W?M/b*8:M/b*2,J=W?(M/b+.25)*30:H.lerp(J,U,A*(W?10:20)),s.rotation.z+=Math.sin(R.clock.elapsedTime*L*.9)/1e3*J,s.rotation.x+=Math.sin(R.clock.elapsedTime*L)/1e3*J,a.current.children[0].rotation.x=Math.sin(R.clock.getElapsedTime()*20)*(M/b)/100,a.current.children[0].rotation.z=Math.cos(R.clock.getElapsedTime()*20)*(M/b)/100});const ue=F(ct,["ready","sound"]),ee=F(mt,["ready","sound"]);return h("group",{children:[h(yt,{ref:a,angularVelocity:e,position:n,rotation:o,children:[r(ue,{}),r(ut,{}),r(dt,{}),r(ee,{}),r(ht,{}),r(gt,{}),t]}),r(D,{children:u.map((R,A)=>r(wt,{ref:R,leftSide:!(A%2)},A))}),r(pt,{}),r(ft,{})]})}const _r=({depth:e,height:t,position:[n,o,s],width:a})=>{const[i]=v(({actions:{reset:E}})=>[E]),l={isTrigger:!0,onCollide:i,userData:{trigger:!0}},u=e/2,p=t/2,f=Math.PI/2,k=a/2;return te(()=>d(w(d({},l),{position:[n-k,o,s],rotation:[0,f,0]}),l)),te(()=>w(d({},l),{position:[n,o-p,s],rotation:[f,0,0]})),te(()=>w(d({},l),{position:[n,o,s-u],rotation:[0,0,0]})),te(()=>w(d({},l),{position:[n+k,o,s],rotation:[0,-f,0]})),te(()=>w(d({},l),{position:[n,o+p,s],rotation:[-f,0,0]})),te(()=>w(d({},l),{position:[n,o,s+u],rotation:[0,Math.PI,0]})),null};function zr(n){var o=n,{args:e}=o,t=j(o,["args"]);const[s]=ye(()=>d({type:"Static",args:e},t),c.exports.useRef(null),[e,t]);return h("mesh",{castShadow:!0,receiveShadow:!0,ref:s,children:[r("boxGeometry",{args:e}),r("meshStandardMaterial",{color:"indianred"})]})}function Ce(n){var o=n,{args:e=[1,1,1]}=o,t=j(o,["args"]);return ye(()=>d({isTrigger:!0,args:e,userData:{trigger:!0}},t),void 0,[e,t]),null}const{VITE_SUPABASE_ANON_KEY:qe,VITE_SUPABASE_URL:Ke}={BASE_URL:"/",MODE:"production",DEV:!1,PROD:!0},xt={key:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJyb2xlIjoiYW5vbiIsImlhdCI6MTYyMzMyMTAxOCwiZXhwIjoxOTM4ODk3MDE4fQ.YISggSEzSk6WsMNkvN2a5MHYWBVjQ84nHwWYne9sTA0",url:"https://tfvnrohsjcgsekfnggks.supabase.co"},vt=e=>typeof e=="string",Fr=vt(qe)?qe:xt.key,Dr=vt(Ke)?Ke:xt.url,ne=jt(Dr,Fr),bt=(e=50)=>ne.from("scores").select().gt("time",1337).limit(e).order("time").then(({data:t})=>t||[]),Vr=({name:e,thumbnail:t,time:n})=>ne.from("scores").insert({name:e,thumbnail:t,time:n}).then(({data:o})=>o||[]),Or=e=>{e({session:ne.auth.session()}),ne.auth.onAuthStateChange((t,n)=>{e({session:n})})},$r=e=>ne.auth.signIn({provider:e}),Wr=()=>ne.auth.signOut();function Hr(){const[e,t]=c.exports.useState([]),[n,o]=c.exports.useState(0),[s,a]=v(l=>[l.leaderboard,l.set]),i=()=>a(l=>w(d({},l),{leaderboard:!1}));return c.exports.useEffect(()=>{!s||Date.now()-n<3e3||(bt(10).then(t),o(Date.now()))},[s]),h("div",{className:`leaderboard popup ${s?"open":""}`,children:[r("button",{className:"popup-close",onClick:i,children:"L"}),r(kt,{className:"popup-content leaderboard-bottom",scores:e})]})}const Ur={1:"images/gold.png",2:"images/silver.png",3:"images/bronze.png"},ce=e=>(e/1e3).toFixed(2),Gr=({name:e,standing:t,time:n})=>h("li",{className:"popup-item",children:[r("span",{className:"leaderboard-name",children:t===1||t===2||t===3?h(D,{children:[r("img",{src:Ur[t],width:13,height:13}),e]}):`${t} ${e}`}),r("span",{className:"popup-item-key",children:r("span",{children:ce(n)})})]}),kt=n=>{var o=n,{scores:e}=o,t=j(o,["scores"]);return r("ul",w(d({},t),{children:e.map((s,a)=>c.exports.createElement(Gr,w(d({},s),{standing:a+1,key:a})))}))},Xe=(e,t)=>{const n=t&&!e?Date.now()-t:0;return`${ce(n)}`};function jr(){const e=c.exports.useRef(null),{finished:t,start:n}=v(({finished:s,start:a})=>({finished:s,start:a}));let o=Xe(t,n);return c.exports.useEffect(()=>{let s=0;return we(a=>{!e.current||a-s<100||(s=a,o=Xe(t,n),e.current.innerText!==o&&(e.current.innerText=o))})},[t,n]),r("div",{className:"clock",children:r("span",{ref:e,children:o})})}const Ct=30,Yr=60,Qe=()=>x.boost<=Ct,Ze=()=>x.boost>Yr?"#00FF00":x.boost>Ct?"#FFE600":"#FF0000",et=()=>`${(100*(1-x.boost/De)).toFixed()}%`;function Jr(){const e=c.exports.useRef(null);let t=Qe(),n=Ze(),o=et();return c.exports.useEffect(()=>we(()=>{!e.current||(t=Qe(),e.current.classList.contains("blink")!==t&&e.current.classList.toggle("blink",t),n=Ze(),e.current.style.stroke!==n&&(e.current.style.stroke=n),o=et(),e.current.style.strokeDashoffset!==o&&(e.current.style.strokeDashoffset=o))})),r("div",{className:"boost-bar",children:h("svg",{width:289,height:55,viewBox:"0 0 289 55",xmlns:"http://www.w3.org/2000/svg",children:[r("path",{className:"boost-bg-path",d:"M13,12 L200,12"}),r("path",{className:"boost-path",d:"M15,12 L198,12",ref:e,style:{stroke:n,strokeDashoffset:o}}),r("text",{className:"boost-text",x:"0",y:"17px",children:r("tspan",{children:"N"})})]})})}const qr=c.exports.forwardRef(({offset:e},t)=>h("svg",{className:"speed-background",width:289,height:55,viewBox:"0 0 289 55",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[r("defs",{children:h("linearGradient",{id:"progress",x1:"1",y1:"0",x2:"0",y2:"0",children:[r("stop",{id:"stop1",offset:e,ref:t,stopColor:"#1B3049"}),r("stop",{id:"stop2",stopColor:"#3EB4C8"})]})}),r("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M0 40c175.256-2.308 227.867-13.823 289-40v55H0V40z",fill:"url(#progress)"})]})),Kr=()=>r("svg",{className:"speed-foreground",width:289,height:55,viewBox:"0 0 289 55",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:r("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M0 40c175.256-2.308 227.867-13.823 289-40v55H0V40zm7.5 9.5v-5h9v5h-9zm24 0h-8v-5h8v5zm7-5v5h9v-5h-9zm16 0v5h9v-5h-9zm16-1v6h8v-6h-8zm16 0v6h8v-6h-8zm24 6h-9v-7h9v7zm15 0h-8v-8h8v8zm16 0h-9v-10h9v10zm16 0h-9v-11h9v11zm15 0h-9v-13l9-.5v13.5zm16 0h-9v-15l9-1v16zm15 0h-9v-17l9-1v18zm16 0h-10v-19l10-1v20zm16 0h-10v-21l10-2v23zm15.5 0h-9.5v-25L251 22v27.5zm16 0h-10v-29l10-3.5v32.5zm16 0h-10V15l10-4v38.5z",fill:"#132237"})}),Xr=e=>()=>`${Math.max(1-x.speed/e,0).toFixed(2)}`,Qr=()=>{const e=c.exports.useRef(null),t=v(s=>s.vehicleConfig.maxSpeed),n=Xr(t);let o=n();return c.exports.useEffect(()=>we(()=>{!e.current||(o=n(),e.current.getAttribute("offset")!==o&&e.current.setAttribute("offset",o))})),h("div",{className:"speed-gauge",children:[r(qr,{offset:o,ref:e}),r(Kr,{})]})},tt=()=>`${x.speed.toFixed()}`,Zr=()=>{const e=c.exports.useRef(null);let t=tt();return c.exports.useEffect(()=>we(()=>{!e.current||(t=tt(),e.current.innerText!==t&&(e.current.innerText=t))})),h("div",{className:"speed-text",children:[r("span",{ref:e,children:t})," mph"]})};function eo(){return h("div",{className:"speed",children:[r(Qr,{}),r(Zr,{}),r(Jr,{})]})}const Ge=Oe,{directionLocal:Lo,axleLocal:To,rollInfluence:Ao}=Ge,to=j(Ge,["directionLocal","axleLocal","rollInfluence"]),{debug:ro,shadows:oo,stats:no}=Re,so=d(d({debug:ro,dpr:it,shadows:oo,stats:no},to),Ve);function ao(){const[e,t,n,o,s,a]=v(m=>[m.get,m.set,m.debug,m.dpr,m.shadows,m.stats]),{back:i,force:l,front:u,height:p,maxBrake:f,maxSpeed:k,steer:E,width:I}=Ve,{customSlidingRotationalSpeed:g,frictionSlip:b,radius:C,sideAcceleration:y,suspensionStiffness:P,suspensionRestLength:B,useCustomSlidingRotationalSpeed:z}=Oe,[,$]=Yt(()=>({Performance:me({dpr:{value:o,min:1,max:2,step:.5,onChange:m=>t({dpr:m})},shadows:{value:s,onChange:m=>t({shadows:m})}}),Vehicle:me({radius:{value:C,min:.1,max:2,step:.01,onChange:m=>t({wheelInfo:w(d({},e().wheelInfo),{radius:m})})},width:{value:I,min:.1,max:10,step:.01,onChange:m=>t({vehicleConfig:w(d({},e().vehicleConfig),{width:m})})},height:{value:p,min:-5,max:5,step:.01,onChange:m=>t({vehicleConfig:w(d({},e().vehicleConfig),{height:m})})},front:{value:u,min:-10,max:10,step:.05,onChange:m=>t({vehicleConfig:w(d({},e().vehicleConfig),{front:m})})},back:{value:i,min:-10,max:10,step:.05,onChange:m=>t({vehicleConfig:w(d({},e().vehicleConfig),{back:m})})},steer:{value:E,min:.1,max:1,step:.01,onChange:m=>t({vehicleConfig:w(d({},e().vehicleConfig),{steer:m})})},force:{value:l,min:0,max:3e3,step:1,onChange:m=>t({vehicleConfig:w(d({},e().vehicleConfig),{force:m})})},maxBrake:{value:f,min:.1,max:100,step:.01,onChange:m=>t({vehicleConfig:w(d({},e().vehicleConfig),{maxBrake:m})})},maxSpeed:{value:k,min:1,max:150,step:1,onChange:m=>t({vehicleConfig:w(d({},e().vehicleConfig),{maxSpeed:m})})}},{collapsed:!0}),Suspension:me({suspensionStiffness:{value:P,min:0,max:500,step:1,onChange:m=>t({wheelInfo:w(d({},e().wheelInfo),{suspensionStiffness:m})})},suspensionRestLength:{value:B,min:-10,max:10,step:.01,onChange:m=>t({wheelInfo:w(d({},e().wheelInfo),{suspensionRestLength:m})})},useCustomSlidingRotationalSpeed:{value:z,onChange:m=>t({wheelInfo:w(d({},e().wheelInfo),{useCustomSlidingRotationalSpeed:m})})},customSlidingRotationalSpeed:{value:g,min:-10,max:10,step:.01,onChange:m=>t({wheelInfo:w(d({},e().wheelInfo),{customSlidingRotationalSpeed:m})})},frictionSlip:{value:b,min:-10,max:10,step:.01,onChange:m=>t({wheelInfo:w(d({},e().wheelInfo),{frictionSlip:m})})},sideAcceleration:{value:y,min:-10,max:10,step:.01,onChange:m=>t({wheelInfo:w(d({},e().wheelInfo),{sideAcceleration:m})})}},{collapsed:!0}),Debug:me({debug:{value:n,onChange:m=>t({debug:m})},stats:{value:a,onChange:m=>t({stats:m})}},{collapsed:!0}),reset:Jt(()=>{$(so)})}));return null}const io=[{provider:"google",label:"Sign in with Google",Logo:()=>h("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 70 72",children:[r("path",{fill:"#4285F4",d:"m70 37-1-7H36v14h19c-1 4-3 8-7 10v9h11c7-6 11-15 11-26z"}),r("path",{fill:"#34A853",d:"M36 72c9 0 17-3 23-9l-11-9a21 21 0 0 1-32-11H4v9c6 12 18 20 32 20z"}),r("path",{fill:"#FBBC05",d:"M16 43a21 21 0 0 1 0-13V20H4a36 36 0 0 0 0 32l12-9z"}),r("path",{fill:"#EA4335",d:"M36 15c5 0 10 2 13 5l11-10A36.6 36.6 0 0 0 4 20l12 10c3-9 10-15 20-15z"})]})},{provider:"github",label:"Sign in with Github",Logo:()=>h("svg",{role:"img",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:[r("title",{children:"GitHub"}),r("path",{fill:"#181717",d:"M12 .3a12 12 0 0 0-3.8 23.4c.6.1.8-.3.8-.6v-2c-3.3.7-4-1.6-4-1.6-.6-1.4-1.4-1.8-1.4-1.8-1-.7.1-.7.1-.7 1.2 0 1.9 1.2 1.9 1.2 1 1.8 2.8 1.3 3.5 1 0-.8.4-1.3.7-1.6-2.7-.3-5.5-1.3-5.5-6 0-1.2.5-2.3 1.3-3.1-.2-.4-.6-1.6 0-3.2 0 0 1-.3 3.4 1.2a11.5 11.5 0 0 1 6 0c2.3-1.5 3.3-1.2 3.3-1.2.6 1.6.2 2.8 0 3.2a4 4 0 0 1 1.3 3.2c0 4.6-2.8 5.6-5.5 5.9.5.4.9 1 .9 2.2v3.3c0 .3.1.7.8.6A12 12 0 0 0 12 .3"})]})}];function St(){const e=async t=>{try{await $r(t)}catch(n){alert(n.error_description||n.message)}};return h("div",{children:[r("h2",{className:"auth-header",children:"Want to save your score?"}),r("div",{className:"auth-providers",children:io.map(({provider:t,label:n,Logo:o},s)=>h("button",{className:"auth-provider",onClick:()=>e(t),children:[r(o,{}),r("span",{children:n})]},s))})]})}const lo=()=>{var C,y;const[e,t,n]=v(({actions:{reset:P},finished:B,session:z})=>[P,z,B]),[o,s]=c.exports.useState(""),[a,i]=c.exports.useState([]),[l,u]=c.exports.useState(0),p=((C=t==null?void 0:t.user)==null?void 0:C.aud)==="authenticated",f=(y=t==null?void 0:t.user)==null?void 0:y.user_metadata,k=f==null?void 0:f.full_name,E=f==null?void 0:f.avatar_url,I=()=>{const P=a.findIndex(B=>B.id===o);u(P&&P+1)},g=()=>{bt().then(i)},b=()=>{Vr({name:k,thumbnail:E,time:n}).then(([{id:P}])=>s(P)).then(g).then(I)};return c.exports.useEffect(g,[n]),c.exports.useEffect(I,[o,a]),h("div",{className:"finished",children:[r("div",{className:"finished-header",children:h("h1",{children:["Good job! Your time was ",ce(n)," seconds"]})}),r("div",{className:"finished-leaderboard",children:r(kt,{className:"leaderboard",scores:a})}),r("div",{className:"finished-auth",children:p?r(D,{children:o?l?h("h1",{children:["You are number #",l]}):null:h(D,{children:[h("h2",{children:["You belong on our leaderboard, ",k,"! "]}),r("button",{onClick:b,style:{margin:"0 auto",width:"auto"},className:"popup-item-key",children:"Add my score"})]})}):r(St,{})}),r("div",{className:"finished-restart",children:r("button",{className:"restart-btn",onClick:e,children:"Restart"})})]})},Mt={alt:"Alt \u2325",arrowdown:"\u2193",arrowleft:"\u2190",arrowright:"\u2192",arrowup:"\u2191",backspace:"Backspace \u232B",capslock:"CapsLock \u21EA",control:"Control \u2303",enter:"Enter \u21B5",meta:"Meta \u2318",shift:"Shift \u21E7"," ":"Space \u2423",tab:"Tab \u21E5"},co=e=>Object.hasOwnProperty.call(Mt,e),Le={backward:{displayName:"Backward",order:1},boost:{displayName:"Turbo Boost",order:6},brake:{displayName:"Drift",order:4},camera:{displayName:"Toggle Camera",order:14},editor:{displayName:"Editor",order:8},forward:{displayName:"Forward",order:0},help:{displayName:"Help",order:9},honk:{displayName:"Honk",order:5},leaderboard:{displayName:"Leaderboards",order:10},left:{displayName:"Left",order:2},map:{displayName:"Map",order:11},pickcolor:{displayName:"Pick Car Color",order:12},reset:{displayName:"Reset",order:7},right:{displayName:"Right",order:3},sound:{displayName:"Toggle Mute",order:13}};function uo({actionName:e,hasError:t,inputs:n,onAdd:o,onRemove:s}){return h("div",{className:`keys-row popup-item${t?" with-error":""}`,children:[r("div",{children:Le[e].displayName}),h("div",{className:"popup-item-keys",children:[n.map((a,i)=>r("button",{onClick:()=>{s(e,a)},className:"key-button popup-item-key",children:r("span",{children:co(a)?Mt[a]:a.toUpperCase()})},i)),r("button",{className:"add-button popup-item-key hovered-item",onClick:()=>{o(e)},children:r("span",{children:"+"})})]})]})}function mo({onAdd:e}){const[t]=v(({actionInputMap:o})=>[o]),n=c.exports.useCallback((o,s)=>{Q(l=>{var u=l,{actionInputMap:a}=u,i=j(u,["actionInputMap"]);return d({actionInputMap:w(d({},a),{[o]:a[o].filter(p=>p!==s)})},i)})},[]);return r(D,{children:le(t).sort((o,s)=>Le[o].order-Le[s].order).map((o,s)=>r(uo,{actionName:o,inputs:t[o],onRemove:n,onAdd:e,hasError:!t[o].length},s))})}function ho({onKeyup:e}){return c.exports.useEffect(()=>(window.addEventListener("keyup",e,{passive:!0}),()=>{window.removeEventListener("keyup",e)}),[e]),r("div",{className:"key-input-wrapper",children:r("div",{className:"key-input",children:"Press new key"})})}function Et(e){const[t,n]=c.exports.useState(null),[o,s]=v(({actions:l,binding:u})=>[l,u]),a=c.exports.useCallback(l=>{n(l),s||o.binding()},[s]),i=c.exports.useCallback(({key:l})=>{if(!t)return;const u=l.toLowerCase();if(u==="escape")return n(null);Q(k=>{var E=k,{actionInputMap:p}=E,f=j(E,["actionInputMap"]);return d({actionInputMap:le(p).reduce((I,g)=>w(d({},I),{[g]:g===t?p[g].concat(u):p[g].filter(b=>b!==u)}),{})},f)}),n(null),s&&o.binding()},[s,t]);return h(D,{children:[r("div",w(d({},e),{children:r(mo,{onAdd:a})})),t&&r(ho,{onKeyup:i})]})}function po(){const[e,t,n]=v(o=>[o.set,o.help,o.sound]);return h(D,{children:[r("div",{className:`${n?"sound":"nosound"}`}),h("div",{className:"help",children:[!t&&r("button",{onClick:()=>e({help:!0}),children:"i"}),h("div",{className:`popup ${t?"open":""}`,children:[r("button",{className:"popup-close",onClick:()=>e({help:!1}),children:"i"}),r("div",{className:"popup-content",children:r(Et,{})})]})]})]})}const Se=new ze,go=new V,Me=new V,rt=new qt,Ee=new V;function Pt(){const[e]=c.exports.useState(()=>new Zt),[t]=c.exports.useState(()=>new V),[n]=c.exports.useState(()=>new V),o=v(s=>s.level);return c.exports.useLayoutEffect(()=>{var s;!((s=o.current)!=null&&s.parent)||(o.current.parent.updateWorldMatrix(!1,!1),e.setFromObject(o.current),e.getCenter(t),e.getSize(n))},[]),[e,t,n]}function fo({buffer:e}){const t=c.exports.useRef(null),n=ie(i=>i.gl),o=ie(i=>i.scene),[s,a]=Pt();return c.exports.useEffect(()=>{!t.current||(n.setRenderTarget(e),t.current.bottom=s.min.z-a.z,t.current.top=s.max.z-a.z,t.current.left=s.min.x-a.x,t.current.right=s.max.x-a.x,t.current.position.set(a.x,a.y+s.max.y,a.z),t.current.updateProjectionMatrix(),n.render(o,t.current),n.setRenderTarget(null))},[s,a]),c.exports.useLayoutEffect(()=>{!t.current||(t.current.layers.disableAll(),t.current.layers.enable(fe))},[fe]),r(_e,{ref:t,makeDefault:!1,rotation:[-Math.PI/2,0,0],near:20,far:500})}function yo({size:e=200}){const t=c.exports.useRef(null),n=c.exports.useRef(null),o=c.exports.useRef(null),[s]=c.exports.useState(()=>new Kt),a=ge("textures/mask.svg"),i=ge("textures/cursor.svg"),l=Xt(e*2,e*2),{gl:u,camera:p,scene:f,size:{height:k,width:E}}=ie(),[,I,g]=Pt(),b=v(y=>y.chassisBody),C=c.exports.useMemo(()=>new V(E/-2-e/-2+30,k/-2-e/-2+30,0),[k,E,e]);return O(()=>{!n.current||!o.current||(u.autoClear=!0,u.render(f,p),u.autoClear=!1,u.clearDepth(),Se.copy(p.matrix).invert(),n.current.quaternion.setFromRotationMatrix(Se),b.current&&t.current&&(Ee.subVectors(b.current.getWorldPosition(go),I),t.current.quaternion.setFromRotationMatrix(Se),t.current.position.set(C.x+Ee.x/g.x*e,C.y-Ee.z/g.z*e,0),b.current.getWorldDirection(Me),rt.set(Me.x,Me.z),t.current.material.rotation=Math.PI/2-rt.angle()),u.render(s,o.current))},1),h(D,{children:[Qt(h(D,{children:[r("ambientLight",{intensity:1}),r("sprite",{ref:n,position:C,scale:[e,e,1],children:r("spriteMaterial",{map:l.texture,alphaMap:a})}),r("sprite",{ref:t,position:C,scale:[e/20,e/20,1],children:r("spriteMaterial",{color:"white",alphaMap:i})})]}),s),r(_e,{ref:o,position:[0,0,.1]}),r(fo,{buffer:l})]})}const wo="ws://localhost:2567",xo="game_room",vo=new er.exports.Client(wo);let Y,It;const bo=async()=>{Y=await vo.joinOrCreate(xo),It=Y.sessionId},ko=async()=>{Y||await bo()},ot=()=>Y.state.players;function Co({children:e}){var f;const[t,n]=c.exports.useState(!1),[o,s]=c.exports.useState(!0),[a,i]=c.exports.useState(!1),{progress:l}=tr(),[u,p]=v(k=>[k.session,k.set]);return c.exports.useEffect(()=>{t&&!o&&p({ready:!0})},[t,o]),c.exports.useEffect(()=>{l===100&&s(!1)},[l]),c.exports.useEffect(()=>{Or(p)},[]),c.exports.useEffect(()=>{Y.state.players.onAdd(()=>{i(Y.state.players.size==2)}),Y.state.players.onRemove(()=>{i(Y.state.players.size==2)})},[]),h(D,{children:[r(c.exports.Suspense,{fallback:null,children:e}),h("div",{className:`fullscreen bg ${o?"loading":"loaded"} ${t&&"clicked"}`,children:[h("div",{className:"stack",children:[h("div",{className:"intro-keys",children:[r(Et,{style:{paddingBottom:20}}),r("p",{children:o?`loading ${l.toFixed()} %`:a?r("a",{className:"start-link",href:"#",onClick:()=>n(!0),children:"Click to start"}):"Waiting for another player..."})]}),((f=u==null?void 0:u.user)==null?void 0:f.aud)!=="authenticated"?r(St,{}):h("div",{children:["Hello ",u.user.user_metadata.full_name,r("button",{className:"logout",onClick:Wr,children:"Logout"})," "]})]}),r(rr,{date:"2. June",year:"2021",link1:r("a",{href:"https://github.com/pmndrs/react-three-fiber",children:"@react-three/fiber"}),link2:r("a",{href:"https://github.com/pmndrs/racing-game",children:"/racing-game"})})]})]})}function So(){const[e,t]=v(({bestCheckpoint:i,checkpoint:l})=>[i,l]),n=!e||t<e,o=e?t-e:t;c.exports.useEffect(()=>{if(!t)return;const i=setTimeout(()=>{Q({bestCheckpoint:t&&n?t:e,checkpoint:0})},3e3);return()=>clearTimeout(i)});const s=n?"green":"red",a=`${n?"":"+"}${ce(o)}`;return h("div",{className:"checkpoint",children:[r("p",{children:ce(t)}),r("p",{className:s,children:a})]})}function Mo(){const[e,t]=v(a=>[a.color,a.pickcolor]),n=a=>Q({color:a}),o=()=>Q({pickcolor:!1}),s=F(or,"pickcolor");return h("div",{className:`pickcolor popup ${t?"open":""}`,children:[r("button",{className:"popup-close",onClick:o,children:"P"}),r("div",{className:"pickcolor-container popup-content",children:r(s,{color:e,onChange:n})})]})}const{lerp:Pe}=H,Ie=new V;function Eo(e){const{playerId:t,angularVelocity:n,children:o,position:s,rotation:a}=e,i=ie(N=>N.camera),[l,u,p,f]=v(N=>[N.chassisBody,N.vehicleConfig,N.wheelInfo,N.wheels]),{back:k,force:E,front:I,height:g,maxBrake:b,steer:C,maxSpeed:y,width:P}=u,B=f.map((N,_)=>{const Rt=_<2?I:k,Nt=_%2?.5:-.5;return w(d({},p),{chassisConnectionPointLocal:[P*Nt,g,Rt],isFrontWheel:Boolean(_%2)})}),z={chassisBody:l,wheels:f,wheelInfos:B},[,$]=at(()=>z,null,[p]);c.exports.useLayoutEffect(()=>$.sliding.subscribe(N=>x.sliding=N),[$]);let m,X,S,W=0,M=0,T=!1,L=0,U=0,J=0,ue=0,ee=0;Y.state.players.get(t),O((N,_)=>{for(m=G().camera,X=G().editor,S=G().controls,L=x.speed,T=S.boost&&x.boost>0,T&&(x.boost=Math.max(x.boost-1,0)),W=Pe(W,S.forward||S.backward?E*(S.forward&&!S.backward?T?-1.5:-1:1):0,_*20),U=Pe(U,S.left||S.right?C*(S.left&&!S.right?1:-1):0,_*20),M=2;M<4;M++)$.applyEngineForce(L<y?W:0,M);for(M=0;M<2;M++)$.setSteeringValue(U,M);for(M=2;M<4;M++)$.setBrake(S.brake?S.forward?b/1.5:b:0,M);X||(m==="FIRST_PERSON"?Ie.set(.3+Math.sin(-U)*L/30,.4,-.1):m==="DEFAULT"&&Ie.set(Math.sin(U)*L/2.5,1.25+W/1e3*-.5,-5-L/15+(S.brake?1:0)),i.position.lerp(Ie,_),i.rotation.z=Pe(i.rotation.z,(m!=="BIRD_EYE"?0:Math.PI)+-U*L/(m==="DEFAULT"?40:60),_)),l.current.children[0].rotation.z=H.lerp(l.current.children[0].rotation.z,-U*L/200,_*4),J=T?60:30,ue=T?L/y*8:L/y*2,ee=T?(L/y+.25)*30:H.lerp(ee,ue,_*(T?10:20)),i.rotation.z+=Math.sin(N.clock.elapsedTime*J*.9)/1e3*ee,i.rotation.x+=Math.sin(N.clock.elapsedTime*J)/1e3*ee,l.current.children[0].rotation.x=Math.sin(N.clock.getElapsedTime()*20)*(L/y)/100,l.current.children[0].rotation.z=Math.cos(N.clock.getElapsedTime()*20)*(L/y)/100});const R=F(ct,["ready","sound"]),A=F(mt,["ready","sound"]);return h("group",{children:[h(yt,{ref:l,angularVelocity:n,position:s,rotation:a,children:[r(R,{}),r(ut,{}),r(dt,{}),r(A,{}),r(ht,{}),r(gt,{}),o]}),r(D,{children:f.map((N,_)=>r(wt,{ref:N,leftSide:!(_%2)},_))}),r(pt,{}),r(ft,{})]})}const Te=new nr;Te.enable(fe);function Po(){const[e,t]=c.exports.useState(null),[n,o,s,a]=v(C=>[C.actions,C.dpr,C.editor,C.shadows]),{onCheckpoint:i,onFinish:l,onStart:u}=n,p=F(So,"checkpoint"),f=F(ur,"debug"),k=F(ao,"editor"),E=F(lo,"finished"),I=F(yo,"map"),g=F(sr,"editor"),b=F(dr,"stats");return h(Co,{children:[h(ar,{dpr:[1,o],shadows:a,camera:{position:[0,5,15],fov:50},children:[r("fog",{attach:"fog",args:["white",0,500]}),r(ir,{sunPosition:[100,10,100],distance:1e3}),r("ambientLight",{layers:Te,intensity:.1}),r("directionalLight",{ref:t,layers:Te,position:[0,50,150],intensity:1,"shadow-bias":-.001,"shadow-mapSize":[4096,4096],"shadow-camera-left":-150,"shadow-camera-right":150,"shadow-camera-top":150,"shadow-camera-bottom":-150,castShadow:!0}),r(st,{makeDefault:s,fov:75,position:[0,20,20]}),r(lr,{allowSleep:!0,broadphase:"SAP",defaultContactMaterial:{contactEquationRelaxation:4,friction:.001},children:h(f,{scale:1.0001,color:"white",children:[Array.from(ot().keys()).map(C=>{const y=ot().get(C);return console.log(y.position.toJSON()),C===It?h(Ar,{angularVelocity:[y.angularVelocity.x,y.angularVelocity.y,y.angularVelocity.z],position:[y.spawnPosition.x,y.spawnPosition.y,y.spawnPosition.z],rotation:[y.rotation.x,y.rotation.y,y.rotation.z],children:[e&&r("primitive",{object:e.target}),r(Sr,{})]},C):r(Eo,{playerId:C,angularVelocity:[y.angularVelocity.x,y.angularVelocity.y,y.angularVelocity.z],position:[y.spawnPosition.x,y.spawnPosition.y,y.spawnPosition.z],rotation:[y.rotation.x,y.rotation.y,y.rotation.z]},C)}),r(Br,{}),r(zr,{args:[30,6,8],position:[2,-1,168.55],rotation:[0,.49,Math.PI/15]}),r(Rr,{elementSize:.5085,position:[327-66.5,-3.3,-473+213],rotation:[-Math.PI/2,0,-Math.PI]}),r(Ce,{args:[.001,10,18],onCollideBegin:u,rotation:[0,.55,0],position:[-27,1,180]}),r(Ce,{args:[.001,10,18],onCollideBegin:l,rotation:[0,-1.2,0],position:[-104,1,-189]}),r(Ce,{args:[.001,10,18],onCollideBegin:i,rotation:[0,-.5,0],position:[-50,1,-5]}),r(_r,{depth:512,height:100,position:[0,40,0],width:512})]})}),r(Nr,{}),r(cr,{files:"textures/dikhololo_night_1k.hdr"}),r(I,{}),r(g,{})]},`${o}${a}`),r(jr,{}),r(k,{}),r(E,{}),r(po,{}),r(eo,{}),r(b,{}),r(p,{}),r(Hr,{}),r(Mo,{}),r(br,{}),r(vr,{})]})}ge.preload("/textures/heightmap_1024.png");Z.preload("/models/track-draco.glb");Z.preload("/models/chassis-draco.glb");Z.preload("/models/wheel-draco.glb");const Io={color:"green",paddingLeft:"2%"},Ro={color:"red",paddingLeft:"2%"},Ae=mr(document.getElementById("root"));Ae.render(r("div",{style:Io,children:r("h2",{children:"Initializing network..."})}));ko().then(()=>{Ae.render(r(Po,{}))}).catch(e=>{console.error(e),Ae.render(h("div",{style:Ro,children:[r("h2",{children:"Network failure!"}),r("h3",{children:"Is your server running?"})]}))});
